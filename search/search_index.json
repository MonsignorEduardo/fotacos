{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"fotacos","text":"<p>Es un app para la rasbery de fotos</p>"},{"location":"modules/","title":"API Reference","text":""},{"location":"modules/#main-module","title":"Main Module","text":"<p>Main entry point for fotacos application.</p>"},{"location":"modules/#fotacos.main.cli","title":"<code>cli()</code>","text":"<p>Fotacos - Photo Album Application.</p> Source code in <code>src/fotacos/main.py</code> <pre><code>@click.group()\n@click.version_option(version=\"0.0.1\")\ndef cli():\n    \"\"\"Fotacos - Photo Album Application.\"\"\"\n</code></pre>"},{"location":"modules/#fotacos.main.gui","title":"<code>gui()</code>","text":"<p>Run the desktop GUI application.</p> Source code in <code>src/fotacos/main.py</code> <pre><code>@cli.command()\ndef gui():\n    \"\"\"Run the desktop GUI application.\"\"\"\n    # Lazy import to avoid Qt dependencies when not needed\n    from fotacos.gui import run_gui\n\n    run_gui()\n</code></pre>"},{"location":"modules/#fotacos.main.main","title":"<code>main()</code>","text":"<p>Main entry point.</p> Source code in <code>src/fotacos/main.py</code> <pre><code>def main():\n    \"\"\"Main entry point.\"\"\"\n    cli()\n</code></pre>"},{"location":"modules/#fotacos.main.web","title":"<code>web(host, port, reload)</code>","text":"<p>Run the web server.</p> Source code in <code>src/fotacos/main.py</code> <pre><code>@click.command()\n@click.option(\"--host\", default=\"127.0.0.1\", help=\"Host to bind to\")\n@click.option(\"--port\", default=8000, type=int, help=\"Port to bind to\")\n@click.option(\"--reload\", is_flag=True, help=\"Enable auto-reload for development\")\ndef web(host: str, port: int, reload: bool):\n    \"\"\"Run the web server.\"\"\"\n    run_web(host=host, port=port, reload=reload)\n</code></pre>"},{"location":"modules/#api","title":"API","text":"<p>FastAPI application configuration and setup.</p>"},{"location":"modules/#fotacos.api.app.lifespan","title":"<code>lifespan(app)</code>  <code>async</code>","text":"<p>Application lifespan manager for startup and shutdown.</p> Source code in <code>src/fotacos/api/app.py</code> <pre><code>@asynccontextmanager\nasync def lifespan(app: FastAPI):\n    \"\"\"Application lifespan manager for startup and shutdown.\"\"\"\n    logger.info(\"Starting Fotacos API application\")\n    settings.ensure_directories()\n    logger.debug(\"Ensured upload directories exist\")\n    await init_db()\n    logger.info(\"Database initialized successfully\")\n    yield\n    logger.info(\"Shutting down Fotacos API application\")\n    await close_db()\n    logger.info(\"Database connection closed\")\n</code></pre>"},{"location":"modules/#routes","title":"Routes","text":"<p>Photo management API routes.</p>"},{"location":"modules/#fotacos.api.routes.photos.PhotoListResponse","title":"<code>PhotoListResponse</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Response model for listing photos.</p> Source code in <code>src/fotacos/api/routes/photos.py</code> <pre><code>class PhotoListResponse(BaseModel):\n    \"\"\"Response model for listing photos.\"\"\"\n\n    photos: list[PhotoResponse]\n    total: int\n</code></pre>"},{"location":"modules/#fotacos.api.routes.photos.PhotoResponse","title":"<code>PhotoResponse</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Response model for a photo.</p> Source code in <code>src/fotacos/api/routes/photos.py</code> <pre><code>class PhotoResponse(BaseModel):\n    \"\"\"Response model for a photo.\"\"\"\n\n    id: int\n    filename: str\n    original_url: str\n    thumbnail_url: str\n    file_size: int\n    created_at: str\n</code></pre>"},{"location":"modules/#fotacos.api.routes.photos.delete_photo","title":"<code>delete_photo(photo_id)</code>  <code>async</code>","text":"<p>Delete a photo, its thumbnail, and database record.</p> Source code in <code>src/fotacos/api/routes/photos.py</code> <pre><code>@router.delete(\"/photos/{photo_id}\")\nasync def delete_photo(photo_id: int) -&gt; dict[str, str]:\n    \"\"\"Delete a photo, its thumbnail, and database record.\"\"\"\n    logger.info(f\"Received delete request for photo ID: {photo_id}\")\n    photo = await Photo.get_or_none(id=photo_id)\n\n    if not photo:\n        logger.warning(f\"Photo not found for deletion: ID {photo_id}\")\n        raise HTTPException(status_code=404, detail=\"Photo not found\")\n\n    full_photo_path = settings.upload_dir / photo.filename\n    thumbnail_photo_path = settings.upload_dir / \"thumbnails\" / photo.filename\n\n    if full_photo_path.exists():\n        full_photo_path.unlink()\n        logger.debug(f\"Deleted original photo file: {full_photo_path}\")\n\n    if thumbnail_photo_path.exists():\n        thumbnail_photo_path.unlink()\n        logger.debug(f\"Deleted thumbnail file: {thumbnail_photo_path}\")\n\n    await photo.delete()\n    logger.info(f\"Successfully deleted photo: {photo.filename} (ID: {photo_id})\")\n\n    return {\"message\": f\"Photo {photo.filename} deleted successfully\"}\n</code></pre>"},{"location":"modules/#fotacos.api.routes.photos.list_photos","title":"<code>list_photos()</code>  <code>async</code>","text":"<p>List all photos from the database.</p> Source code in <code>src/fotacos/api/routes/photos.py</code> <pre><code>@router.get(\"/photos\", response_model=PhotoListResponse)\nasync def list_photos() -&gt; PhotoListResponse:\n    \"\"\"List all photos from the database.\"\"\"\n    logger.info(\"Fetching all photos from database\")\n    photos = await Photo.all().order_by(\"-created_at\")\n\n    photo_responses = [\n        PhotoResponse(\n            id=photo.id,\n            filename=photo.filename,\n            original_url=photo.original_url,\n            thumbnail_url=photo.thumbnail_url,\n            file_size=photo.file_size,\n            created_at=photo.created_at.isoformat(),\n        )\n        for photo in photos\n    ]\n\n    logger.debug(f\"Retrieved {len(photo_responses)} photos\")\n    return PhotoListResponse(photos=photo_responses, total=len(photo_responses))\n</code></pre>"},{"location":"modules/#fotacos.api.routes.photos.upload_photo","title":"<code>upload_photo(file)</code>  <code>async</code>","text":"<p>Upload a new photo, generate thumbnail, and save to database.</p> Source code in <code>src/fotacos/api/routes/photos.py</code> <pre><code>@router.post(\"/photos\", response_model=PhotoResponse)\nasync def upload_photo(file: Annotated[UploadFile, File(description=\"Photo file to upload\")]) -&gt; PhotoResponse:\n    \"\"\"Upload a new photo, generate thumbnail, and save to database.\"\"\"\n    logger.info(f\"Received photo upload request: {file.filename}\")\n\n    if not file.filename:\n        logger.warning(\"Upload attempt with no filename\")\n        raise HTTPException(status_code=400, detail=\"No filename provided\")\n\n    # Validate extension\n    ext = Path(file.filename).suffix.lower()\n    if ext not in ALLOWED_EXTENSIONS:\n        logger.warning(f\"Invalid file extension attempted: {ext} for file {file.filename}\")\n        raise HTTPException(\n            status_code=400,\n            detail=f\"File type not allowed. Allowed types: {', '.join(ALLOWED_EXTENSIONS)}\",\n        )\n\n    # Validate MIME type\n    if not file.content_type or not file.content_type.startswith(\"image/\"):\n        logger.warning(f\"Invalid MIME type: {file.content_type} for file {file.filename}\")\n        raise HTTPException(status_code=400, detail=\"Uploaded file is not an image\")\n\n    unique_id = uuid.uuid4()\n    webp_filename = f\"photo_{unique_id}.webp\"\n    logger.debug(f\"Generated unique filename: {webp_filename}\")\n\n    full_photo_path = settings.upload_dir / webp_filename\n    thumbnail_photo_path = settings.upload_dir / \"thumbnails\" / webp_filename\n\n    # Ensure directories exist\n    full_photo_path.parent.mkdir(parents=True, exist_ok=True)\n    thumbnail_photo_path.parent.mkdir(parents=True, exist_ok=True)\n\n    try:\n        logger.debug(\"Converting image to WebP format\")\n        # Convert original to WebP\n        webp_stream = convert_to_webp(file.file)\n\n        # Save converted WebP to disk\n        with open(full_photo_path, \"wb\") as f:\n            f.write(webp_stream.read())\n        logger.debug(f\"Saved original WebP image to {full_photo_path}\")\n\n        # Generate WebP thumbnail from the webp_stream\n        webp_stream.seek(0)  # Reset stream for thumbnail generation\n        logger.debug(\"Generating thumbnail\")\n        thumbnail_stream = generate_thumbnail(webp_stream)\n\n        # Save thumbnail to disk\n        with open(thumbnail_photo_path, \"wb\") as f:\n            f.write(thumbnail_stream.read())\n        logger.debug(f\"Saved thumbnail to {thumbnail_photo_path}\")\n\n        # Get the actual file size of the WebP image\n        file_size = full_photo_path.stat().st_size\n        logger.info(f\"Successfully processed image: {webp_filename} (size: {file_size} bytes)\")\n    except Exception as e:\n        logger.error(f\"Failed to process image {file.filename}: {e}\", exc_info=True)\n        # If conversion fails, delete all created files and raise error\n        full_photo_path.unlink(missing_ok=True)\n        thumbnail_photo_path.unlink(missing_ok=True)\n        raise HTTPException(status_code=500, detail=f\"Failed to process image: {e}\") from e\n\n    # Generate URLs for the mounted static directories\n    original_url = f\"/public/picts/{webp_filename}\"\n    thumbnail_url = f\"/public/picts/thumbnails/{webp_filename}\"\n\n    photo = await Photo.create(\n        filename=webp_filename,\n        original_url=original_url,\n        thumbnail_url=thumbnail_url,\n        file_size=file_size,\n    )\n\n    return PhotoResponse(\n        id=photo.id,\n        filename=photo.filename,\n        original_url=photo.original_url,\n        thumbnail_url=photo.thumbnail_url,\n        file_size=photo.file_size,\n        created_at=photo.created_at.isoformat(),\n    )\n</code></pre>"},{"location":"modules/#models","title":"Models","text":"<p>Photo database model.</p>"},{"location":"modules/#fotacos.models.photo.Photo","title":"<code>Photo</code>","text":"<p>               Bases: <code>Model</code></p> <p>Photo model representing stored images.</p> Source code in <code>src/fotacos/models/photo.py</code> <pre><code>class Photo(Model):\n    \"\"\"Photo model representing stored images.\"\"\"\n\n    id = fields.IntField(primary_key=True)\n    filename = fields.CharField(max_length=255, unique=True, index=True)\n    original_url = fields.CharField(max_length=512)\n    thumbnail_url = fields.CharField(max_length=512)\n    file_size = fields.IntField(default=0)\n    created_at = fields.DatetimeField(auto_now_add=True)\n\n    def __str__(self):\n        return self.filename\n</code></pre>"},{"location":"modules/#services","title":"Services","text":"<p>Image processing service using PIL.</p>"},{"location":"modules/#fotacos.services.images.convert_to_webp","title":"<code>convert_to_webp(input_photo, quality=None)</code>","text":"<p>Convert an image to WebP format.</p> <p>Parameters:</p> Name Type Description Default <code>input_photo</code> <code>BinaryIO</code> <p>BinaryIO stream containing the source image</p> required <code>quality</code> <code>int | None</code> <p>WebP quality (0-100), default 90</p> <code>None</code> <p>Returns:</p> Type Description <code>BinaryIO</code> <p>BinaryIO stream containing the converted WebP image</p> Source code in <code>src/fotacos/services/images.py</code> <pre><code>def convert_to_webp(\n    input_photo: BinaryIO,\n    quality: int | None = None,\n) -&gt; BinaryIO:\n    \"\"\"\n    Convert an image to WebP format.\n\n    Args:\n        input_photo: BinaryIO stream containing the source image\n        quality: WebP quality (0-100), default 90\n\n    Returns:\n        BinaryIO stream containing the converted WebP image\n    \"\"\"\n    if quality is None:\n        quality = 90  # High quality for original images\n\n    # Reset stream position to beginning\n    input_photo.seek(0)\n\n    with Image.open(input_photo) as img:\n        # Fix orientation from EXIF data\n        img = _fix_orientation(img)\n\n        # Convert to RGB if necessary\n        if img.mode in (\"RGBA\", \"P\"):\n            # For WebP, we can preserve transparency\n            if img.mode == \"P\":\n                img = img.convert(\"RGBA\")\n        elif img.mode not in (\"RGB\", \"RGBA\"):\n            img = img.convert(\"RGB\")\n\n        # Save as WebP to BytesIO\n        output = BytesIO()\n        img.save(output, \"WEBP\", quality=quality, method=6)\n\n        # Reset output stream position for reading\n        output.seek(0)\n        return output\n</code></pre>"},{"location":"modules/#fotacos.services.images.generate_thumbnail","title":"<code>generate_thumbnail(input_photo, size=None)</code>","text":"<p>Generate a thumbnail from the source image.</p> <p>Parameters:</p> Name Type Description Default <code>input_photo</code> <code>BinaryIO</code> <p>BinaryIO stream containing the source image</p> required <code>size</code> <code>tuple[int, int] | None</code> <p>Thumbnail dimensions (width, height), default from settings</p> <code>None</code> <p>Returns:</p> Type Description <code>BinaryIO</code> <p>BinaryIO stream containing the thumbnail WebP image</p> Source code in <code>src/fotacos/services/images.py</code> <pre><code>def generate_thumbnail(\n    input_photo: BinaryIO,\n    size: tuple[int, int] | None = None,\n) -&gt; BinaryIO:\n    \"\"\"\n    Generate a thumbnail from the source image.\n\n    Args:\n        input_photo: BinaryIO stream containing the source image\n        size: Thumbnail dimensions (width, height), default from settings\n\n    Returns:\n        BinaryIO stream containing the thumbnail WebP image\n    \"\"\"\n    if size is None:\n        size = THUMBNAIL_SIZE\n\n    # Reset stream position to beginning\n    input_photo.seek(0)\n\n    with Image.open(input_photo) as img:\n        # Fix orientation from EXIF data\n        img = _fix_orientation(img)\n\n        # Convert to RGB if necessary (for PNG with transparency, etc.)\n        if img.mode in (\"RGBA\", \"P\"):\n            # Create white background for transparent images\n            background = Image.new(\"RGB\", img.size, (255, 255, 255))\n            if img.mode == \"P\":\n                img = img.convert(\"RGBA\")\n            background.paste(img, mask=img.split()[-1] if img.mode == \"RGBA\" else None)\n            img = background\n        elif img.mode != \"RGB\":\n            img = img.convert(\"RGB\")\n\n        # Create thumbnail maintaining aspect ratio\n        img.thumbnail(size, Image.Resampling.LANCZOS)\n\n        # Save as WebP to BytesIO\n        output = BytesIO()\n        img.save(output, \"WEBP\", quality=settings.thumbnail_quality, method=6)\n\n        # Reset output stream position for reading\n        output.seek(0)\n        return output\n</code></pre>"},{"location":"modules/#database","title":"Database","text":"<p>Database configuration and initialization.</p>"},{"location":"modules/#fotacos.database.close_db","title":"<code>close_db()</code>  <code>async</code>","text":"<p>Close database connections.</p> Source code in <code>src/fotacos/database.py</code> <pre><code>async def close_db() -&gt; None:\n    \"\"\"Close database connections.\"\"\"\n    await Tortoise.close_connections()\n</code></pre>"},{"location":"modules/#fotacos.database.init_db","title":"<code>init_db()</code>  <code>async</code>","text":"<p>Initialize Tortoise ORM and generate schema.</p> Source code in <code>src/fotacos/database.py</code> <pre><code>async def init_db() -&gt; None:\n    \"\"\"Initialize Tortoise ORM and generate schema.\"\"\"\n    settings = get_settings()\n\n    await Tortoise.init(\n        db_url=settings.database_url,\n        modules={\"models\": [\"fotacos.models.photo\"]},\n    )\n    await Tortoise.generate_schemas()\n</code></pre>"},{"location":"modules/#configuration","title":"Configuration","text":"<p>Application settings using Pydantic Settings.</p>"},{"location":"modules/#fotacos.env.Settings","title":"<code>Settings</code>","text":"<p>               Bases: <code>BaseSettings</code></p> <p>Application settings with environment variable support.</p> Source code in <code>src/fotacos/env.py</code> <pre><code>class Settings(BaseSettings):\n    \"\"\"Application settings with environment variable support.\"\"\"\n\n    model_config = SettingsConfigDict(\n        env_file=\".env\",\n        env_file_encoding=\"utf-8\",\n        case_sensitive=False,\n        extra=\"ignore\",\n    )\n\n    database_url: str = Field(\n        default=\"sqlite://fotacos.db\",\n        description=\"SQLite database URL\",\n    )\n\n    upload_dir: Path = Field(\n        default=Path(\"public/picts\"),\n        description=\"Directory for uploaded photos\",\n    )\n\n    api_host: str = Field(default=\"127.0.0.1\", description=\"API host address\")\n    api_port: int = Field(default=8000, description=\"API port\")\n    cors_origins: list[str] = Field(\n        default=[\"http://localhost:3000\"],\n        description=\"CORS allowed origins\",\n    )\n\n    thumbnail_size: int = Field(\n        default=300,\n        description=\"Thumbnail size (width and height in pixels)\",\n    )\n    thumbnail_quality: int = Field(\n        default=85,\n        description=\"JPEG quality for thumbnails (1-100)\",\n    )\n\n    debug: bool = Field(\n        default=False,\n        description=\"Debug mode for development\",\n    )\n\n    def ensure_directories(self) -&gt; None:\n        \"\"\"Create upload and thumbnail directories if they don't exist.\"\"\"\n        self.upload_dir.mkdir(parents=True, exist_ok=True)\n</code></pre>"},{"location":"modules/#fotacos.env.Settings.ensure_directories","title":"<code>ensure_directories()</code>","text":"<p>Create upload and thumbnail directories if they don't exist.</p> Source code in <code>src/fotacos/env.py</code> <pre><code>def ensure_directories(self) -&gt; None:\n    \"\"\"Create upload and thumbnail directories if they don't exist.\"\"\"\n    self.upload_dir.mkdir(parents=True, exist_ok=True)\n</code></pre>"},{"location":"modules/#fotacos.env.get_settings","title":"<code>get_settings()</code>  <code>cached</code>","text":"<p>Get cached settings instance.</p> Source code in <code>src/fotacos/env.py</code> <pre><code>@lru_cache\ndef get_settings() -&gt; Settings:\n    \"\"\"Get cached settings instance.\"\"\"\n    return Settings()\n</code></pre>"}]}